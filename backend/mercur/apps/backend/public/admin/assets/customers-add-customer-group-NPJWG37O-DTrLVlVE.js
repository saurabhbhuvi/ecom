import{u as F,a as z,b as E}from"./chunk-ZJRFL6ZN-C-j4eNnu.js";import{ac as I,j as e,b as j,r as p,ef as D,aw as H,ax as M,aq as N,e6 as O,t as C,Y as q,B as S,aB as K,as as L,f as V,ag as Z,Z as b}from"./index-CvSP96Hk.js";import{u as $,_ as Q}from"./chunk-B2JT2FOA-D0HDx-IV.js";import"./chunk-GJUPECDU-5JTz06Il.js";import{K as Y}from"./chunk-6HTZNHPT-BzwgbIaf.js";import{R as c,u as J}from"./chunk-4TC5YS65-BNyjzD1r.js";import"./chunk-C76H5USB-JjZb0MmM.js";import"./chunk-MSDRGCRR-Dq0SSFfB.js";import"./chunk-P3UUX2T6-BuRiUFOH.js";import"./chunk-YEDAFXMB-CQkR4Rfb.js";import"./chunk-M3VFKDXJ-CI_RbZJk.js";import"./chunk-AOFGTNG6-BI0RuRIn.js";import"./chunk-EMIHDNB7-BG4ReTQM.js";import"./chunk-PFKKVLZX-BkbFDlOP.js";var U=N({customer_group_ids:K(L()).min(1)}),g=10,W=({customerId:a})=>{const{t:o}=j(),{handleSuccess:f}=J(),[r,u]=p.useState(!1),{mutateAsync:h}=D(a),i=H({defaultValues:{customer_group_ids:[]},resolver:M(U)}),{setValue:n}=i,[l,_]=p.useState({});p.useEffect(()=>{n("customer_group_ids",Object.keys(l).filter(t=>l[t]),{shouldDirty:!0,shouldTouch:!0})},[l,n]);const{searchParams:v,raw:T}=F({pageSize:g}),w=z(),{customer_groups:m,count:y,isPending:P,isError:R,error:k}=O({fields:"*customers",...v}),A=t=>{const s=typeof t=="function"?t(l):t,d=Object.keys(s);n("customer_group_ids",d,{shouldDirty:!0,shouldTouch:!0}),_(s)},x=ee(),{table:G}=$({data:m??[],columns:x,count:y,enablePagination:!0,enableRowSelection:t=>{var s;return!((s=t.original.customers)!=null&&s.map(d=>d.id).includes(a))},getRowId:t=>t.id,pageSize:g,rowSelection:{state:l,updater:A}}),B=i.handleSubmit(async t=>{u(!0);try{await h({add:t.customer_group_ids}),C.success(o("customers.groups.add.success",{groups:t.customer_group_ids.map(s=>m==null?void 0:m.find(d=>d.id===s)).filter(Boolean).map(s=>s==null?void 0:s.name)})),f(`/customers/${a}`)}catch(s){C.error(s.message)}finally{u(!1)}});if(R)throw k;return e.jsx(c.Form,{form:i,children:e.jsxs(Y,{className:"flex h-full flex-col overflow-hidden",onSubmit:B,children:[e.jsx(c.Header,{children:e.jsx("div",{className:"flex items-center justify-end gap-x-2",children:i.formState.errors.customer_group_ids&&e.jsx(q,{variant:"error",children:i.formState.errors.customer_group_ids.message})})}),e.jsx(c.Body,{className:"size-full overflow-hidden",children:e.jsx(Q,{table:G,columns:x,pageSize:g,count:y,filters:w,orderBy:[{key:"name",label:o("fields.name")},{key:"created_at",label:o("fields.createdAt")},{key:"updated_at",label:o("fields.updatedAt")}],isLoading:P,layout:"fill",search:"autofocus",queryObject:T,noRecords:{message:o("customers.groups.add.list.noRecordsMessage")}})}),e.jsxs(c.Footer,{children:[e.jsx(c.Close,{asChild:!0,children:e.jsx(S,{variant:"secondary",size:"small",children:o("actions.cancel")})}),e.jsx(S,{type:"submit",variant:"primary",size:"small",isLoading:r,children:o("actions.save")})]})]})})},X=V(),ee=()=>{const{t:a}=j(),o=E();return p.useMemo(()=>[X.display({id:"select",header:({table:r})=>e.jsx(b,{checked:r.getIsSomePageRowsSelected()?"indeterminate":r.getIsAllPageRowsSelected(),onCheckedChange:u=>r.toggleAllPageRowsSelected(!!u)}),cell:({row:r})=>{const u=!r.getCanSelect(),h=r.getIsSelected()||u,i=e.jsx(b,{checked:h,disabled:u,onCheckedChange:n=>r.toggleSelected(!!n),onClick:n=>{n.stopPropagation()}});return u?e.jsx(Z,{content:a("customers.groups.alreadyAddedTooltip"),side:"right",children:i}):i}}),...o],[a,o])},ge=()=>{const{id:a}=I();return e.jsx(c,{children:e.jsx(W,{customerId:a})})};export{ge as Component};
